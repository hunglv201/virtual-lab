<!DOCTYPE html>
<html lang="vi">

<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- style css -->
    <link rel="stylesheet" href="css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<!-- body -->

<body>
    <div id="loading"></div>
    <div id="loadingGoto">
        <div class="one"></div>
        <div class="two"></div>
        <div class="three"></div>
    </div>
    <div class="area">
        <div id="main-layout" class="layout-start-practice">
            <div class="layout1">
                <span class="note"></span>
                <img id="cat" class="in-game an" src="./images/tb9-7.svg" />
                <img id="vun-giay" class="in-game an" src="./images/tb9-2.svg" />

                <img class="in-game oj40 oj-scale-choose" src="./images/40.png" />
                <img class="in-game oj38 " src="./images/38.png" />
                <img class="in-game oj41 " src="./images/41.svg" />
                <img class="in-game hp " src="./images/hp.png" />

                <img id="binh1" class="in-game dungcu binh1 " src="./images/tb1.png" draggable="true" ondragstart="drag(event)" />
                <img id="binh2" class="in-game dungcu binh2 " src="./images/tb9-8.png" draggable="true" ondragstart="drag(event)" />

                <img id="pheu" class="in-game dungcu pheu " src="./images/tb2.png" draggable="true" ondragstart="drag(event)" />
                <img id="giay-loc" class="in-game dungcu giay-loc " src="./images/tb3.png" draggable="true" ondragstart="drag(event)" />

                <img id="ray" class="in-game dungcu ray " src="./images/tb6.png" draggable="true" ondragstart="drag(event)" />
                <img id="dua" class="in-game dungcu dua " src="./images/tb8.png" draggable="true" ondragstart="drag(event)" />

                <img id="than-hoat-tinh" class="in-game dungcu than-hoat-tinh " src="./images/tb10.png" draggable="true" ondragstart="drag(event)" />

                <img class="in-game tb11-prac thungrac " src="./images/tb11.png" draggable="true" ondragstart="drag(event)" />
                <img class="in-game tb12-prac thungrac" src="./images/tb12.png" draggable="true" ondragstart="drag(event)" />
                <img class="in-game tb13-prac thungrac" src="./images/tb13.png" draggable="true" ondragstart="drag(event)" />

                <span class="button-don-dep " onclick="dondep()">  Thu dọn</span>
                <span class="button-hoanthanh " onclick="goListLap()">  Hoàn thành</span>

            </div>

        </div>
        <ul class="circles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>

    <script>
        var step = 1;

        var state = 1; //chua giay, cat, ban   tb9-8  tb1
        // state = 2; //chua cat, ban tb9-9  tb1
        // state = 3; //chua ban tb9-10
        // state = 4; //chua ban , than  tb9-5
        // state = 0 //sạch

        if (state == 1) {
            $(".binh1").attr("src", "./images/tb1.png")
            $(".binh2").attr("src", "./images/tb9-8.png")
        } else if (state == 2) {
            $(".binh1").attr("src", "./images/tb1.png")
            $(".binh2").attr("src", "./images/tb9-9.png")
        } else if (state == 3) {
            $(".binh1").attr("src", "./images/tb1.png")
            $(".binh2").attr("src", "./images/tb9-10.png")
        } else if (state == 4) {
            $(".binh1").attr("src", "./images/tb1.png")
            $(".binh2").attr("src", "./images/tb9-5.png")
        } else if (state == 0) {
            $(".binh1").attr("src", "./images/tb1.png")
            $(".binh2").attr("src", "./images/tb9-10.png")
        }

        huongdan();

        var stepStatus = "dang" // dodep, xong

        function drag(ev) {

            var idTB = ev.target.id
            if (idTB == "binh1") {
                if (checkbinhrong() == "b1") {
                    binh1donuoc(false)
                } else {
                    if (state == 1) {
                        if (checkdungcudangdung().includes("loc")) {

                        }

                        if (checkdungcudangdung() == "ray") {
                            setTimeout(function() {
                                state = 2
                                $("#vun-giay").addClass("hien-vun-giay2")
                                setTimeout(function() {
                                    $("#vun-giay").removeClass("hien-vun-giay2")
                                    themNote("Tuyệt vời, vụn nilon đã được giữ lại trên rây do lớn hơn lỗ rây nên bị kẹt lại- Nhưng nước, cát lại chảy xuyên qua lỗ rây. Các con hãy thử nghĩ cách để lọc cát ra khỏi nước nhé")
                                }, 3000)

                            }, 2000)

                        }
                    }
                    binh1donuoc(true)
                }

            } else if (idTB == "binh2") {
                if (checkbinhrong() != "b1") {
                    binh2donuoc(flase)
                } else {
                    if (state == 1) {
                        if (checkdungcudangdung().includes("loc")) {

                        }

                        if (checkdungcudangdung() == "ray") {
                            setTimeout(function() {
                                state = 2
                                $("#vun-giay").addClass("hien-vun-giay1")
                                setTimeout(function() {
                                    $("#vun-giay").removeClass("hien-vun-giay1")
                                    themNote("Tuyệt vời, vụn nilon đã được giữ lại trên rây do lớn hơn lỗ rây nên bị kẹt lại- Nhưng nước, cát lại chảy xuyên qua lỗ rây. Các con hãy thử nghĩ cách để lọc cát ra khỏi nước nhé")
                                }, 3000)

                            }, 2000)

                        }
                    }
                    binh2donuoc(true)
                }

            } else if (idTB == "pheu") {
                checkdungcudangdung()
                if (state == 1) {
                    datpheu()
                    themNote("Chỉ có phễu thôi không đủ. Con cần thêm một vật dụng nữa để lọc nước.")
                } else {
                    datpheu()
                }
            } else if (idTB == "giay-loc") {
                checkdungcudangdung()
                datloc()
            } else if (idTB == "ray") {
                if (state == 1) {
                    if (checkdungcudangdung() !== "pheu" && checkdungcudangdung() !== "giay")
                        datray()
                } else {
                    datray()
                }

            } else if (idTB == "dua") {
                datdua()
            } else if (idTB == "than-hoat-tinh") {
                if (state != 3) {
                    dothanvaobinh(false)
                } else {
                    dothanvaobinh(true)
                }

            }
        }

        setTimeout(function() {
            document.getElementById("loading").style.display = "none";
            document.getElementById("main-layout").style.display = "block";
        }, 0);

        function dothanvaobinh(active) {
            if (active) {
                if (checkbinhrong() == "b1") {
                    $(".than-hoat-tinh").toggleClass("do-than-binh1")
                    setTimeout(function() {
                        $(".than-hoat-tinh").toggleClass("do-than-binh1")
                    }, 4000)
                } else {
                    $(".than-hoat-tinh").toggleClass("do-than-binh2")
                    setTimeout(function() {
                        $(".than-hoat-tinh").toggleClass("do-than-binh2")
                    }, 4000)
                }

            } else {
                $(".than-hoat-tinh").toggleClass("chon-sai")
                themNote("Ý tưởng hay đấy! Nhưng con chỉ nên sử dụng than hoạt tính để khử màu cho nước khi không còn các tạp chất bẩn như đá và cát ở trong nước nữa. Con hãy nghĩ cách loại bỏ các chất bẩn ra khỏi nước nhé.")
                setTimeout(function() {
                    $(".than-hoat-tinh").toggleClass("chon-sai")
                }, 1200)
            }

        }

        function binh1donuoc(active) {
            if (active) {
                $(".binh1").toggleClass("do-binh-1")
                setTimeout(function() {
                    $(".binh1").toggleClass("do-binh-1")
                    if (state == 1) {
                        $(".binh1").attr("src", "./images/tb1.png")
                        $(".binh2").attr("src", "./images/tb9-8.png")
                    } else if (state == 2) {
                        $(".binh1").attr("src", "./images/tb1.png")
                        $(".binh2").attr("src", "./images/tb9-9.png")
                    } else if (state == 3) {
                        $(".binh1").attr("src", "./images/tb1.png")
                        $(".binh2").attr("src", "./images/tb9-10.png")
                    } else if (state == 4) {
                        $(".binh1").attr("src", "./images/tb1.png")
                        $(".binh2").attr("src", "./images/tb9-5.png")
                    } else if (state == 0) {
                        $(".binh1").attr("src", "./images/tb1.png")
                        $(".binh2").attr("src", "./images/tb9-10.png")
                    }
                    resetdungcu()
                }, 4000)


            } else {
                $(".binh1").toggleClass("chon-sai")
                setTimeout(function() {
                    $(".binh1").toggleClass("chon-sai")
                }, 1200)
            }

        }

        function binh2donuoc(active) {
            if (active) {
                $(".binh2").toggleClass("do-binh-2")
                setTimeout(function() {
                    $(".binh2").toggleClass("do-binh-2")
                    if (state == 1) {
                        $(".binh2").attr("src", "./images/tb1.png")
                        $(".binh1").attr("src", "./images/tb9-8.png")
                    } else if (state == 2) {
                        $(".binh2").attr("src", "./images/tb1.png")
                        $(".binh1").attr("src", "./images/tb9-9.png")
                    } else if (state == 3) {
                        $(".binh2").attr("src", "./images/tb1.png")
                        $(".binh1").attr("src", "./images/tb9-10.png")
                    } else if (state == 4) {
                        $(".binh2").attr("src", "./images/tb1.png")
                        $(".binh1").attr("src", "./images/tb9-5.png")
                    } else if (state == 0) {
                        $(".binh2").attr("src", "./images/tb1.png")
                        $(".binh1").attr("src", "./images/tb9-10.png")
                    }
                    resetdungcu()
                }, 4000)


                if (state == 0) {
                    setTimeout(function() {
                        themNote("- Thành công rồi! Nước đã hoàn toàn sạch trở lại. Con đã hoàn thành xuất sắc giúp bạn nước lấy lại màu xanh cho mình. - Bây giờ, chúng ta chỉ cần dọn dẹp phòng thí nghiệm sạch sẽ nữa thôi! ")
                        $(".dungcu").css("opacity", "0")
                        $(".hp").css("display", "block")
                        $(".button-don-dep").css("display", "block")
                    }, 5000)

                }
            } else {
                $(".binh2").toggleClass("chon-sai")
                setTimeout(function() {
                    $(".binh2").toggleClass("chon-sai")
                }, 1200)
            }

        }

        function resetdungcu() {
            setTimeout(function() {
                $(".ray").removeClass("ray-binh1")
                $(".pheu").removeClass("pheu-binh1")
                $(".giay-loc").removeClass("loc-binh1")
                $(".ray").removeClass("ray-binh2")
                $(".pheu").removeClass("pheu-binh2")
                $(".giay-loc").removeClass("loc-binh2")
            }, 1000)
        }

        function checkdungcudangdung() {
            var ray = $("#ray").attr('class')
            var pheu = $("#pheu").attr('class')
            var giay = $("#giay-loc").attr('class')
            var rs = "";
            if (ray.includes("ray-binh1") || ray.includes("ray-binh2")) {
                rs = rs + "ray"
            }

            if (pheu.includes("pheu-binh1") || pheu.includes("pheu-binh2")) {
                rs = rs + "pheu"
            }

            if (giay.includes("loc-binh1") || giay.includes("loc-binh2")) {
                rs = rs + "giay"
            }

            console.log(rs)
            return rs
        }

        function datdua() {

            $(".dua").toggleClass("chon-sai")
            setTimeout(function() {
                $(".dua").toggleClass("chon-sai")
            }, 1200)
        }

        function datray() {
            if (true) {
                if (checkbinhrong() == "b1") {
                    $(".ray").toggleClass("ray-binh1")
                } else {
                    $(".ray").toggleClass("ray-binh2")
                }
            } else {
                $(".ray").toggleClass("chon-sai")
                setTimeout(function() {
                    $(".ray").toggleClass("chon-sai")
                }, 1200)
            }
        }

        function datpheu() {
            if (true) {
                if (checkbinhrong() == "b1") {
                    $(".pheu").toggleClass("pheu-binh1")
                } else {
                    $(".pheu").toggleClass("pheu-binh2")
                }

            } else {
                $(".pheu").toggleClass("chon-sai")
                themNote("Chỉ có phễu thôi không đủ. Con cần thêm một vật dụng nữa để lọc nước.")
                setTimeout(function() {
                    $(".pheu").toggleClass("chon-sai")
                }, 1200)
            }



        }

        function themNote(note) {
            $(".note").text(note)
            setTimeout(function() {
                huongdan()
            }, 8000)
        }

        function datloc() {
            if (true) {
                if (checkbinhrong() == "b1") {
                    $(".giay-loc").toggleClass("loc-binh1")
                } else {
                    $(".giay-loc").toggleClass("loc-binh2")
                }
            } else {
                $(".giay-loc").toggleClass("chon-sai")
                themNote("Không được rồi! Giấy bị dính nước sẽ mềm nên trượt vào cốc. Con cần tìm một dụng cụ nào đó để đỡ giấy lọc.")
                setTimeout(function() {
                    $(".giay-loc").toggleClass("chon-sai")
                }, 1200)
            }

        }

        function checkbinhrong() {
            var imgb1 = $(".binh1").attr('src');
            if (imgb1.includes("tb1")) {
                return "b1"
            } else {
                return "b2"
            }
        }

        function goListLap() {
            $("#main-layout").addClass("layout-opacity-7")
            $("#loadingGoto").css("display", "flex")
            setTimeout(function() {
                window.location.href = 'rs-test.html'
            }, 600)
        }

        function dondep() {
            $(".thungrac").toggleClass("show-thungrac")
            $(".dungcu").css("opacity", "1")
            $(".hp").css("display", "none")

            $(".button-don-dep").css("display", "none")
            $(".button-hoanthanh").css("display", "block")
        }

        function huongdan() {
            if (state == 0) {
                $(".note").text("Thành công rồi! Nước đã hoàn toàn sạch trở lại. Con đã hoàn thành xuất sắc giúp bạn nước lấy lại màu xanh cho mình. ")
                setTimeout(function() {
                    $(".note").text("Bây giờ, chúng ta chỉ cần dọn dẹp phòng thí nghiệm sạch sẽ nữa thôi! ")
                }, 15000)
            } else if (state == 1) {
                $(".note").text("Trong nước có vụn nilon và cát. Theo con, chúng ta nên lọc tạp chất nào trước? Các con hãy nghĩ cách lọc tạp chất này ra khỏi nước. ")
                setTimeout(function() {
                    $(".note").text("Con thử nghĩ xem, vụn nilon và cát, tạp chất nào có kích thước lớn hơn thì sẽ được lọc khỏi nước dễ dàng hơn.")
                }, 15000)
            } else if (state == 2) {
                $(".note").text("Bước tiếp theo là lọc cát ra khỏi nước, thử nghĩ xem bạn cần vật dụng gì nào")
            } else if (state == 3) {
                $(".note").text("Để lọc sạch nước, chúng ta cần than hoạt tính, khi hòa lần vào nước, than sẽ lọc ra các hạt đát cát cực nhỏ")
            } else if (state == 4) {
                $(".note").text("Than hoạt  tính có tác dụng lọc màu và khử cả được mùi cho nước đấy con ạ. Tuy nhiên, nước hiện tại vẫn đang có màu xám do than hoạt tính. Con hãy tìm cách lọc than hoạt tính ra khỏi nước để nước trong trở lại nhé!")

            }
        }
    </script>
</body>

</html>